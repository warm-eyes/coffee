(self.webpackChunkcoffee=self.webpackChunkcoffee||[]).push([[338],{3338:(t,o,n)=>{"use strict";n.r(o),n.d(o,{ShoppingBagModule:()=>T});var e=n(8583),i=n(4655),c=n(5988),s=n(7716),g=n(8132),a=n(2238),r=n(1584),l=n(2522),p=n(6627),h=n(1095),u=n(3738);const d=["editDom"];function m(t,o){1&t&&(s.ynx(0),s.TgZ(1,"mat-icon"),s._uU(2,"check_circle"),s.qZA(),s.BQk())}function f(t,o){1&t&&(s.TgZ(0,"mat-icon"),s._uU(1,"panorama_fish_eye"),s.qZA())}const _=function(t){return{active:t}};function C(t,o){if(1&t){const t=s.EpF();s.ynx(0),s.TgZ(1,"mat-card",22),s.TgZ(2,"div",23),s.TgZ(3,"button",24),s.NdJ("click",function(){const o=s.CHM(t).index;return s.oxw(2).addShopping(o)}),s.YNc(4,m,3,0,"ng-container",14),s.YNc(5,f,2,0,"ng-template",null,15,s.W1O),s.qZA(),s.qZA(),s.TgZ(7,"div",25),s.TgZ(8,"div",26),s._UZ(9,"img",27),s.qZA(),s.TgZ(10,"div",28),s.TgZ(11,"div",29),s.TgZ(12,"div",30),s._uU(13),s.qZA(),s.TgZ(14,"div",31),s._uU(15),s.qZA(),s.qZA(),s.TgZ(16,"div",32),s._uU(17),s.qZA(),s.TgZ(18,"div",33),s.TgZ(19,"div",34),s._uU(20),s.ALo(21,"currency"),s.qZA(),s.TgZ(22,"div",35),s.TgZ(23,"button",24),s.NdJ("click",function(){const o=s.CHM(t).$implicit;return s.oxw(2).remove(o)}),s.TgZ(24,"mat-icon",36),s._uU(25,"remove_circle_outline"),s.qZA(),s.qZA(),s.TgZ(26,"span"),s._uU(27),s.qZA(),s.TgZ(28,"button",37),s.NdJ("click",function(){const o=s.CHM(t).$implicit;return s.oxw(2).add(o)}),s.TgZ(29,"mat-icon"),s._uU(30,"add_circle"),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.BQk()}if(2&t){const t=o.$implicit,n=s.MAs(6);s.xp6(2),s.Q6J("ngClass",s.VKq(11,_,t.choose)),s.xp6(2),s.Q6J("ngIf",t.choose)("ngIfElse",n),s.xp6(5),s.Q6J("src",t.large_img,s.LSH),s.xp6(4),s.Oqu(t.name),s.xp6(2),s.Oqu(t.rule),s.xp6(2),s.Oqu(t.enname),s.xp6(3),s.Oqu(s.lcZ(21,9,t.price)),s.xp6(7),s.Oqu(t.count)}}function x(t,o){if(1&t&&(s.ynx(0),s.TgZ(1,"div",20),s.YNc(2,C,31,13,"ng-container",21),s.qZA(),s.BQk()),2&t){const t=s.oxw();s.xp6(2),s.Q6J("ngForOf",t.shoppingBagDatas)}}function b(t,o){1&t&&(s.ynx(0),s.TgZ(1,"div",38),s._uU(2,"\u6ca1\u6709\u6570\u636e"),s.qZA(),s.BQk())}function Z(t,o){1&t&&(s.ynx(0),s.TgZ(1,"mat-icon"),s._uU(2,"check_circle"),s.qZA(),s.BQk())}function M(t,o){1&t&&(s.TgZ(0,"mat-icon"),s._uU(1,"panorama_fish_eye"),s.qZA())}const O=[{path:"",component:(()=>{class t{constructor(t,o,n,e,i,c){this.orderService=t,this.router=o,this.dialog=n,this.cookies=e,this.elementRef=i,this.render2=c,this.shoppingBagDatas=[],this.allChoose=!1,this.editText="\u7f16\u8f91",this.submitText="\u63d0\u4ea4\u8ba2\u5355",this.total=0,this.isContent=!1}ngOnInit(){this.getAllShoppingBag()}back(){window.history.go(-1)}getAllShoppingBag(){let t=this.cookies.get("tokenString");t||this.router.navigate(["/login"]),this.orderService.getShoppingBagCount(t),this.orderService.getAllShoppingBag(t).subscribe(t=>{if(console.log(t),5e3==t.code)return 0==t.result.length?(console.log(11),void(this.isContent=!1)):(console.log(22),this.shoppingBagDatas=t.result,t.result.forEach(t=>{t.choose=!1}),this.isContent=!0,void console.log(this.shoppingBagDatas));this.openMessage(t.msg)})}add(t){let o=this.cookies.get("tokenString");this.orderService.getShoppingBagCount(o),o||this.router.navigate(["/login"]);let n=t.count;n=t.count+1,t.count=n,this.modifyShopcarCount({sid:t.sid,count:t.count,tokenString:o})}remove(t){let o=this.cookies.get("tokenString");this.orderService.getShoppingBagCount(o),o||this.router.navigate(["/login"]);let n=t.count;n>1&&(n=t.count-1,t.count=n),this.modifyShopcarCount({sid:t.sid,tokenString:o,count:t.count})}modifyShopcarCount(t){this.orderService.modifyShopcartCount(t).subscribe(t=>{6e3!=t.code&&this.openMessage(t.msg)}),this.totalMoney()}totalMoney(){this.total=0,this.shoppingBagDatas.forEach(t=>{t.choose&&(this.total+=t.count*t.price)})}addShopping(t){if(this.shoppingBagDatas[t].choose=!this.shoppingBagDatas[t].choose,this.totalMoney(),0!==this.shoppingBagDatas.length){for(let t=0;t<this.shoppingBagDatas.length;t++)if(!this.shoppingBagDatas[t].choose)return void(this.allChoose=!1);this.allChoose=!0}else this.allChoose=!1}chooseAll(){console.log(0xca1c249de38e),this.allChoose?(this.shoppingBagDatas.forEach(t=>{t.choose=!1}),this.allChoose=!1):(this.shoppingBagDatas.forEach(t=>{t.choose||(t.choose=!0)}),this.allChoose=!0),this.totalMoney()}edit(){"\u7f16\u8f91"==this.editText?(this.editText="\u5b8c\u6210",this.submitText="\u5220\u9664\u6240\u9009"):"\u5b8c\u6210"==this.editText&&(this.editText="\u7f16\u8f91",this.submitText="\u63d0\u4ea4\u8ba2\u5355")}submit(){let t=this.cookies.get("tokenString");this.orderService.getShoppingBagCount(t),t||this.router.navigate(["/login"]);let o=[];this.shoppingBagDatas.forEach(t=>{t.choose&&o.push(t.sid)}),console.log("sids ==> ",o),console.log(JSON.stringify(o));let n={tokenString:t,sids:JSON.stringify(o)};if("\u5220\u9664\u6240\u9009"==this.submitText)this.dele(n);else{console.log("\u5b8c\u6210");let t=[];if(this.shoppingBagDatas.forEach(o=>{o.choose&&t.push(o.sid)}),0===t.length)return void this.openMessage("\u8bf7\u9009\u62e9\u8d2d\u4e70\u7684\u5546\u54c1");t=t.join("-"),this.router.navigate([`order/${t}`])}}dele(t){this.orderService.removeProduct(t).subscribe(t=>{console.log(t);for(let o=0;o<this.shoppingBagDatas.length;o++)this.shoppingBagDatas[o].choose&&(this.shoppingBagDatas.splice(o,1),o--)}),this.totalMoney()}openMessage(t){this.dialog.open(c.q,{data:{msg:t}}).afterClosed().subscribe(t=>{console.log(`Dialog result: ${t}`)})}}return t.\u0275fac=function(o){return new(o||t)(s.Y36(g.p),s.Y36(i.F0),s.Y36(a.uw),s.Y36(r.N),s.Y36(s.SBq),s.Y36(s.Qsj))},t.\u0275cmp=s.Xpm({type:t,selectors:[["app-shopping-bag"]],viewQuery:function(t,o){if(1&t&&s.Gf(d,5),2&t){let t;s.iGM(t=s.CRH())&&(o.editDom=t.first)}},decls:35,vars:9,consts:[[1,"shopping-bag"],[1,"top"],[1,"return-box",3,"click"],[1,"icon"],[1,"text"],[1,"edit"],["mat-button","","color","primary",3,"click"],[1,"bg"],["src","../../../assets/images/shopbag_bg.png","alt","",1,"auto-img"],[4,"ngIf"],[1,"bottom-box"],[1,"check-all"],[1,"choice","active",3,"click"],["mat-icon-button",""],[4,"ngIf","ngIfElse"],["elseTemplate",""],[1,"total-box"],[1,"price"],[1,"submit"],["mat-raised-button","","color","primary",3,"click"],[1,"products"],[4,"ngFor","ngForOf"],[1,"products-item"],[1,"choice",3,"ngClass"],["mat-icon-button","",3,"click"],[1,"item"],[1,"item-img"],["alt","",1,"auto-img",3,"src"],[1,"info-box"],[1,"item-info"],[1,"item-nameC"],[1,"item-rule"],[1,"item-nameE"],[1,"item-price-count"],[1,"item-price"],[1,"stepper"],[1,"remove-icon"],["mat-icon-button","","color","primary",3,"click"],[1,"hint-box"]],template:function(t,o){if(1&t&&(s.TgZ(0,"div",0),s.TgZ(1,"div",1),s.TgZ(2,"mat-toolbar"),s.TgZ(3,"div",2),s.NdJ("click",function(){return o.back()}),s.TgZ(4,"mat-icon",3),s._uU(5,"keyboard_arrow_left"),s.qZA(),s.TgZ(6,"span"),s._uU(7,"\u8fd4\u56de"),s.qZA(),s.qZA(),s.TgZ(8,"span",4),s._uU(9,"\u8d2d\u7269\u888b"),s.qZA(),s.TgZ(10,"div",5),s.TgZ(11,"button",6),s.NdJ("click",function(){return o.edit()}),s._uU(12),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.TgZ(13,"div",7),s._UZ(14,"img",8),s.qZA(),s.YNc(15,x,3,1,"ng-container",9),s.YNc(16,b,3,0,"ng-container",9),s.TgZ(17,"div",10),s.TgZ(18,"div",11),s.TgZ(19,"div",12),s.NdJ("click",function(){return o.chooseAll()}),s.TgZ(20,"button",13),s.YNc(21,Z,3,0,"ng-container",14),s.YNc(22,M,2,0,"ng-template",null,15,s.W1O),s.qZA(),s.qZA(),s.TgZ(24,"span"),s._uU(25,"\u5168\u9009"),s.qZA(),s.qZA(),s.TgZ(26,"div",16),s.TgZ(27,"span"),s._uU(28,"\u5408\u8ba1\uff1a"),s.qZA(),s.TgZ(29,"span",17),s._uU(30),s.ALo(31,"currency"),s.qZA(),s.qZA(),s.TgZ(32,"div",18),s.TgZ(33,"button",19),s.NdJ("click",function(){return o.submit()}),s._uU(34),s.qZA(),s.qZA(),s.qZA(),s.qZA()),2&t){const t=s.MAs(23);s.xp6(12),s.Oqu(o.editText),s.xp6(3),s.Q6J("ngIf",o.isContent),s.xp6(1),s.Q6J("ngIf",!o.isContent),s.xp6(5),s.Q6J("ngIf",o.allChoose)("ngIfElse",t),s.xp6(9),s.Oqu(s.lcZ(31,7,o.total)),s.xp6(4),s.Oqu(o.submitText)}},directives:[l.Ye,p.Hw,h.lW,e.O5,e.sg,u.a8,e.mk],pipes:[e.H9],styles:[".top[_ngcontent-%COMP%]{position:fixed;top:0;left:0;z-index:10;width:100%}.top[_ngcontent-%COMP%]   .mat-toolbar-single-row[_ngcontent-%COMP%]{height:46px}.top[_ngcontent-%COMP%]   .return-box[_ngcontent-%COMP%]{position:absolute;color:#0c34ba;font-size:14px;left:21px;top:50%;transform:translateY(-50%)}.top[_ngcontent-%COMP%]   .return-box[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{transform:translateY(30%)}.top[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{display:inline-block;width:100%;font-size:14px;text-align:center}.top[_ngcontent-%COMP%]   .edit[_ngcontent-%COMP%]{position:absolute;color:#0c34ba;font-size:14px;right:21px;top:50%;transform:translateY(-50%)}.bg[_ngcontent-%COMP%]{margin-top:46px;width:100vw;height:50px}.bg[_ngcontent-%COMP%]   .auto-img[_ngcontent-%COMP%]{display:block;height:100%;width:100%}.products[_ngcontent-%COMP%]{padding:10px}.products-item[_ngcontent-%COMP%]{display:flex;padding:10px;margin-bottom:10px}.products-item[_ngcontent-%COMP%]   .choice[_ngcontent-%COMP%]{width:40px}.products-item[_ngcontent-%COMP%]   .choice[_ngcontent-%COMP%]   .mat-icon-button[_ngcontent-%COMP%]{color:#888;transform:translateY(50%)}.products-item[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]   .mat-icon-button[_ngcontent-%COMP%]{color:#0c34ba!important}.products-item[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{flex:1;display:flex}.products-item[_ngcontent-%COMP%]   .item-img[_ngcontent-%COMP%]{width:80px;height:80px}.products-item[_ngcontent-%COMP%]   .item-img[_ngcontent-%COMP%]   .auto-img[_ngcontent-%COMP%]{display:block;width:100%;height:100%}.products-item[_ngcontent-%COMP%]   .info-box[_ngcontent-%COMP%]{margin-left:10px;flex:1}.products-item[_ngcontent-%COMP%]   .item-info[_ngcontent-%COMP%]{display:flex;margin-bottom:10px}.products-item[_ngcontent-%COMP%]   .item-info[_ngcontent-%COMP%]   .item-nameC[_ngcontent-%COMP%]{font-size:14px;margin-right:20px}.products-item[_ngcontent-%COMP%]   .item-info[_ngcontent-%COMP%]   .item-rule[_ngcontent-%COMP%], .products-item[_ngcontent-%COMP%]   .item-nameE[_ngcontent-%COMP%]{font-size:12px;color:#888}.products-item[_ngcontent-%COMP%]   .item-price-count[_ngcontent-%COMP%]{display:flex}.products-item[_ngcontent-%COMP%]   .item-price-count[_ngcontent-%COMP%]   .item-price[_ngcontent-%COMP%]{color:#0c34ba;font-weight:700;margin-right:auto;line-height:40px}.products-item[_ngcontent-%COMP%]   .item-price-count[_ngcontent-%COMP%]   .stepper[_ngcontent-%COMP%]   .remove-icon[_ngcontent-%COMP%]{color:#bdc6f5}.hint-box[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-size:20px;color:#888}.bottom-box[_ngcontent-%COMP%]{position:fixed;border-bottom:1px solid #f7f7f7;bottom:50px;left:0;z-index:10;height:50px;width:100vw;background-color:#fff;display:flex;line-height:50px}.bottom-box[_ngcontent-%COMP%]   .check-all[_ngcontent-%COMP%]{display:flex;margin-right:auto;margin-left:20px}.bottom-box[_ngcontent-%COMP%]   .check-all[_ngcontent-%COMP%]   .mat-icon-button[_ngcontent-%COMP%]{color:#888}.bottom-box[_ngcontent-%COMP%]   .check-all[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]   .mat-icon-button[_ngcontent-%COMP%]{color:#0c34ba}.bottom-box[_ngcontent-%COMP%]   .total-box[_ngcontent-%COMP%]{display:flex}.bottom-box[_ngcontent-%COMP%]   .total-box[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{color:#0c34ba;font-weight:700}.bottom-box[_ngcontent-%COMP%]   .submit[_ngcontent-%COMP%]{margin:0 17px}.bottom-box[_ngcontent-%COMP%]   .mat-raised-button.mat-primary[_ngcontent-%COMP%]{color:#0c34ba;border-radius:20px;color:#fff}.mat-toolbar[_ngcontent-%COMP%]{background-color:#fff}"]}),t})()}];let P=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=s.oAB({type:t}),t.\u0275inj=s.cJS({imports:[[i.Bz.forChild(O)],i.Bz]}),t})();var v=n(2613);let T=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=s.oAB({type:t}),t.\u0275inj=s.cJS({imports:[[e.ez,P,p.Ps,l.g0,h.ot,u.QW,v.Fk]]}),t})()}}]);